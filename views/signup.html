<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
</head>
<body>
        <input type="text" placeholder="First Name" name="firstName" id="fNameInput" required>
        <input type="text" placeholder="Last Name" name="lastName" id="lNameInput" required>
        <!-- <input type="text" placeholder="Username" name="username" required> -->
        <input type="text" placeholder="email" name="email" id="emailInput" required>
        <input type="password" placeholder="password" name="password" id="passwordInput" required>
        <button type="button" onclick="submit()">Sign Up</button>
</body>
<script>
    window.onload = () => {
        token = window.localStorage.getItem("token");
        if(token){
            var http = new XMLHttpRequest();
            http.open("POST","/signin/check",true);
            let data = {
                "token": token
            }
            data = JSON.stringify(data);
            http.setRequestHeader('Content-type', 'application/json');
            http.onload =() => {
                if(http.status == 200){
                    data = JSON.parse(http.responseText);
                    // console.log(data.token);
                    localStorage.setItem('token',data.token);
                    window.location.href = "/";
                }
            }
            http.send(data);
        }
    }
    function submit(){
        // console.log("xxx");
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST","/signup/submit",true);
        var fname = document.getElementById("fNameInput").value
        var lname = document.getElementById("lNameInput").value
        var email = document.getElementById("emailInput").value;
        var password = document.getElementById("passwordInput").value;
        // var params = `email=${email}&password=${password}`;
        let data = {
            "firstName": fname,
            "lastName": lname,
            "email": email,
            "password": password 
        }
        data = JSON.stringify(data);
        xmlHttp.setRequestHeader('Content-type', 'application/json');
        // http.onreadystatechange = function() {//Call a function when the state changes.
        //     if(http.readyState == 4 && http.status == 200) {
        //         alert(http.responseText);
        //     }
        // }
        xmlHttp.onload =() => {
            if(xmlHttp.status == 200){
                data = JSON.parse(xmlHttp.responseText);
                alert("Successful: ",data.message);
                window.location.href = "/signin";
            }
            else{
                alert("error: ",xmlHttp.responseText);
            }
        }
        xmlHttp.send(data);

        return false;
    }
</script>
</html>